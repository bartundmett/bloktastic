{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://bloktastic.dev/schema/bloktastic.schema.json",
  "title": "Bloktastic Package Manifest",
  "description": "Schema for bloktastic.json package manifest files",
  "type": "object",
  "required": ["name", "type", "version", "title", "description", "author"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 2,
      "maxLength": 50,
      "description": "Package identifier (lowercase, hyphens only)"
    },
    "type": {
      "type": "string",
      "enum": ["component", "plugin", "preset"],
      "description": "Type of package"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
      "description": "Semantic version (e.g., 1.0.0, 2.1.0-beta.1)"
    },
    "title": {
      "type": "string",
      "minLength": 3,
      "maxLength": 100,
      "description": "Human-readable title"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Brief description of the package"
    },
    "author": {
      "type": "object",
      "required": ["name", "github"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Author's display name"
        },
        "github": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "description": "GitHub username"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Contact email (optional)"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Author's website (optional)"
        }
      }
    },
    "compatibility": {
      "type": "object",
      "properties": {
        "storyblok": {
          "type": "string",
          "pattern": "^[><=~^]*\\d+\\.\\d+\\.\\d+$",
          "description": "Storyblok version requirement (semver range)"
        },
        "frameworks": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["vue", "nuxt", "react", "nextjs", "astro", "svelte", "sveltekit", "angular", "agnostic"]
          },
          "description": "Supported frontend frameworks"
        },
        "pluginType": {
          "type": "string",
          "enum": ["field-type", "tool-plugin", "sidebar"],
          "description": "Plugin type (for plugins only)"
        }
      }
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9-]+$",
        "maxLength": 30
      },
      "maxItems": 10,
      "uniqueItems": true,
      "description": "Searchable tags"
    },
    "category": {
      "type": "string",
      "enum": [
        "sections",
        "content",
        "navigation",
        "forms",
        "media",
        "layout",
        "commerce",
        "field-plugins",
        "tool-plugins",
        "sidebar-plugins",
        "presets"
      ],
      "description": "Primary category"
    },
    "files": {
      "type": "object",
      "properties": {
        "schema": {
          "type": "string",
          "description": "Path to Storyblok schema JSON"
        },
        "prompt": {
          "type": "string",
          "description": "Path to AI generation prompt"
        },
        "readme": {
          "type": "string",
          "description": "Path to documentation"
        },
        "implementations": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Framework-specific implementations"
        }
      }
    },
    "dependencies": {
      "type": "object",
      "properties": {
        "bloktastic": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Other bloktastic packages required"
        },
        "storyblok": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Storyblok features required"
        },
        "npm": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "NPM packages required for implementations"
        }
      }
    },
    "source": {
      "type": "object",
      "description": "External source (for plugins)",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["github", "gitlab", "npm", "url"]
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "branch": {
          "type": "string"
        }
      }
    },
    "installation": {
      "type": "object",
      "description": "Installation info (for plugins)",
      "properties": {
        "storeUrl": {
          "type": "string",
          "format": "uri",
          "description": "Storyblok Plugin Store URL"
        },
        "selfHosted": {
          "type": "boolean",
          "description": "Can be self-hosted"
        },
        "instructions": {
          "type": "string",
          "description": "Path to installation instructions"
        }
      }
    },
    "includes": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Included packages (for presets)"
    },
    "preview": {
      "type": "object",
      "properties": {
        "thumbnail": {
          "type": "string",
          "format": "uri",
          "description": "Preview thumbnail URL"
        },
        "demo": {
          "type": "string",
          "format": "uri",
          "description": "Live demo URL"
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["maintained", "stable", "community", "deprecated", "archived"],
      "default": "stable",
      "description": "Maintenance status"
    },
    "lastVerified": {
      "type": "string",
      "format": "date",
      "description": "Last verification date"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created": {
          "type": "string",
          "format": "date"
        },
        "updated": {
          "type": "string",
          "format": "date"
        },
        "downloads": {
          "type": "integer",
          "minimum": 0
        },
        "stars": {
          "type": "integer",
          "minimum": 0
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "type": { "const": "component" } }
      },
      "then": {
        "required": ["files"],
        "properties": {
          "files": {
            "required": ["schema", "prompt"]
          }
        }
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "plugin" } }
      },
      "then": {
        "required": ["source", "status"]
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "preset" } }
      },
      "then": {
        "required": ["includes"]
      }
    }
  ]
}
